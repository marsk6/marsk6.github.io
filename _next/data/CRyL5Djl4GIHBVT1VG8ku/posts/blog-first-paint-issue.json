{"pageProps":{"post":{"__typename":"Post","slug":"blog-first-paint-issue","title":"blog 首页样式闪烁问题排查","tags":[{"__typename":"Tag","name":"问题记录"}],"category":null,"ctime":1703821560000,"mtime":1703822100000,"date":"12-29","content":"\n## 问题描述\n\n打开 blog 首页，发现样式会闪烁，非常短暂，看起来先展示 mobile 的样式，再展示 pc 的样式\n\n![[blog-first-paint-issue.gif|400]]\n\n## 问题排查\n\n1. 问题猜想 1，是移动优先的写法导致了问题，但是闪烁很短暂，没法判断第一次展示的样式，以及 debug 到当时的 css。\n\n```jsx *{4}\n<section\n  className={cx(\n    'container flex gap-2 relative',\n    'flex-col', // 👉 默认样式是移动端的样式，再用 @media 适配其他端\n    'lg:max-w-5xl lg:flex-row lg:mt-4 lg:items-start lg:mx-auto'\n  )}\n>\n  ...\n</section>\n```\n\n用 devtools 的 performance screenshot 录制渲染过程，从录制的结果看，页面从窄到宽，但第一次渲染不是 mobile 的样式，所以 `@media` 里的样式不影响渲染顺序。\n\n![[blog-first-paint-issue-1.gif|400]]\n\n2. 问题猜想 2，渲染过程中，js 插入了 css 导致闪烁\n\n```jsx *{4}\n<section\n  className={cx(\n    css`\n      flex: 1;\n      min-height: calc(100.1vh - var(--header-height));\n    `\n  )}\n>\n  {children}\n</section>\n```\n\n代码里有部分 css in js，js 插入 `flex: 1` 后使内容扩大占满了剩余空间，导致了页面闪烁。移除后就没有闪烁的问题。\n\n## 建议\n\nstyle component、emotion 等 css in js 存在非静态代码，无法在构建时抽离 css，因此不建议 tailwindcss 和 css in js 一起使用，避免样式闪烁问题。\n如果要使用 css in js，可以使用 css module 的平替 [vanilla-extract](https://mantine.dev/styles/vanilla-extract/)，它支持在 js 里写 css，在构建时抽离 css。\n\n> 本博客 ([marsk6](https://marsk6.github.io/)) 所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\n","prevArticle":{"__typename":"Post","title":"问题记录-本地开发用 whistle 做代理","slug":"whistle-proxy-in-local-dev"},"nextArticle":null,"readingTime":"1","brief":"首页首屏样式闪烁问题排查，不建议 tailwindcss 和 css in js 一起使用","toc":"- [问题描述](#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0)\n- [问题排查](#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5)\n- [建议](#%E5%BB%BA%E8%AE%AE)"},"relatedTags":[{"__typename":"Tag","name":"问题记录","posts":[{"__typename":"Post","slug":"whistle-proxy-in-local-dev"},{"__typename":"Post","slug":"blog-first-paint-issue"}]}]},"__N_SSG":true}