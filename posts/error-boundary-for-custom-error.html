<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link href="/favicon/favicon.ico" rel="icon" sizes="16x16" type="image/png"/><title>ErrorBoundary 处理自定义错误 | Marsk In Github</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/70cd17ddadb823f6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/70cd17ddadb823f6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2cf4fae4efea9f72.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-154e49d784c7a281.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ab6f79d107f33341.js" defer=""></script><script src="/_next/static/chunks/621-56a342c7c4e8e893.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-95e4ca493d097a5a.js" defer=""></script><script src="/_next/static/UCwSqtk09_Nc--u7l_P6H/_buildManifest.js" defer=""></script><script src="/_next/static/UCwSqtk09_Nc--u7l_P6H/_ssgManifest.js" defer=""></script></head><body class="bg-gray-100"><div id="__next"><section class="flex flex-col max-w-full bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-50"><header class="css-1cuunsk flex shadow items-center bg-white dark:bg-slate-800"><h1 class="ml-auto my-auto dark:text-slate-200 mr-4 font-medium text-xl text-gray-800 cursor-pointer">Marsk&#x27;s Blog</h1><nav class="container mr-auto max-w-screen-lg  flex items-center gap-2"><div class="py-2 px-4 rounded-md font-semibold text-slate-700 dark:text-slate-200 cursor-pointer css-0 e16hwgoc0">Lab</div></nav><div class="mr-4 cursor-pointer"><span>🌞</span></div></header><style data-emotion="css kk9mc1">.css-kk9mc1{-webkit-flex:1;-ms-flex:1;flex:1;min-height:calc(100.1vh - var(--header-height));}</style><main class="container mx-auto max-w-3xl p-4 css-kk9mc1 e124l1kd0"><section><article class="p-2"><header class="mb-4"><p class="text-center font-medium text-4xl">ErrorBoundary 处理自定义错误</p><div class="mt-2 flex justify-center text-xs items-center gap-4"><div class="flex gap-0.5 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-calendar"><path d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path d="M16 3l0 4"></path><path d="M8 3l0 4"></path><path d="M4 11l16 0"></path><path d="M11 15l1 0"></path><path d="M12 15l0 3"></path></svg>Dec 09<!-- -->, <!-- -->2021</div><div class="flex gap-0.5 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-clock"><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path><path d="M12 7l0 5l3 3"></path></svg>2 min read</div></div></header><section class="markdown-body max-w-none dark:bg-slate-900"><h2>背景</h2>
<p><a href="https://zh-hans.reactjs.org/docs/error-boundaries.html" target="_blank" rel="nofollow">错误边界</a>是一种 React 组件，这种组件可以捕获发生在其子组件树任何位置的 JavaScript 错误，并打印这些错误，同时展示降级 UI。</p>
<p>错误边界在==渲染期间、生命周期方法和整个组件树的构造函数==中捕获错误。</p>
<h2>问题</h2>
<p><code>react</code> 强调了只有上面 3 种实现下才会捕获错误。</p>
<p>无法自动捕获下面 4 种实现</p>
<ul>
<li>事件处理</li>
<li>异步代码（例如 <code>setTimeout</code> 、<code>Promise</code>回调函数）</li>
<li>服务端渲染</li>
<li>它自身抛出来的错误（并非它的子组件）</li>
</ul>
<p>通常希望业务代码能够复用 <code>ErrorBoundary</code> 的错误处理逻辑。</p>
<h2>实现</h2>
<p>如果要 <code>ErrorBoundary</code> 能处理业务代码的自定义错误，只要在渲染期间抛出错误即可。</p>
<h3>class component</h3>
<pre><code class="language-javascript">try {
  const res = await fetchMayError()
} catch (err) {
  this.setState(() =&gt; {
    throw err
  })
}
</code></pre>
<h3>hooks</h3>
<pre><code class="language-typescript">function useErrorHandler() {
  const [error, setError] = React.useState(null)
  if (error != null) throw error
  return setError
}

function Foo() {
  const handleError = useErrorHandler()
  fetchMayError().catch(handleError)
  return &lt;div&gt;&lt;/div&gt;
}
</code></pre>
<h2>Inspired</h2>
<ol>
<li><a href="https://github.com/bvaughn/react-error-boundary" target="_blank" rel="nofollow">https://github.com/bvaughn/react-error-boundary</a></li>
</ol>
<blockquote>
<p>本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
</blockquote></section></article></section></main><div class="text-center text-xs text-gray-400 mb-4">© 2022 Marsk. Powered by Next.js. Hosted on GitHub.</div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"error-boundary-for-custom-error","title":"ErrorBoundary 处理自定义错误","tags":[{"name":"Blog"},{"name":"react"}],"category":null,"ctime":1639057680000,"date":"Dec 09","content":"\n\n## 背景\n\n[错误边界](https://zh-hans.reactjs.org/docs/error-boundaries.html)是一种 React 组件，这种组件可以捕获发生在其子组件树任何位置的 JavaScript 错误，并打印这些错误，同时展示降级 UI。\n\n错误边界在==渲染期间、生命周期方法和整个组件树的构造函数==中捕获错误。\n\n## 问题\n\n`react` 强调了只有上面 3 种实现下才会捕获错误。\n\n无法自动捕获下面 4 种实现\n\n- 事件处理\n- 异步代码（例如 `setTimeout` 、`Promise`回调函数）\n- 服务端渲染\n- 它自身抛出来的错误（并非它的子组件）\n\n通常希望业务代码能够复用 `ErrorBoundary` 的错误处理逻辑。\n\n## 实现\n\n如果要 `ErrorBoundary` 能处理业务代码的自定义错误，只要在渲染期间抛出错误即可。\n\n### class component\n\n```javascript\ntry {\n  const res = await fetchMayError()\n} catch (err) {\n  this.setState(() =\u003e {\n    throw err\n  })\n}\n```\n\n### hooks\n\n```typescript\nfunction useErrorHandler() {\n  const [error, setError] = React.useState(null)\n  if (error != null) throw error\n  return setError\n}\n\nfunction Foo() {\n  const handleError = useErrorHandler()\n  fetchMayError().catch(handleError)\n  return \u003cdiv\u003e\u003c/div\u003e\n}\n```\n\n## Inspired\n\n1. https://github.com/bvaughn/react-error-boundary\n\n\u003e 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\n","prev":{},"next":{},"readingTime":"2 min read","toc":"- [背景](#%E8%83%8C%E6%99%AF)\n- [问题](#%E9%97%AE%E9%A2%98)\n- [实现](#%E5%AE%9E%E7%8E%B0)\n  * [class component](#class-component)\n  * [hooks](#hooks)\n- [Inspired](#inspired)"},"relatedTags":[{"name":"Blog","posts":[{"slug":"error-boundary-for-custom-error"},{"slug":"git-includeif"},{"slug":"whistle-proxy-in-local-dev"},{"slug":"expo-intro"}]},{"name":"react","posts":[{"slug":"error-boundary-for-custom-error"}]}]},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"error-boundary-for-custom-error"},"buildId":"UCwSqtk09_Nc--u7l_P6H","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>