{"pageProps":{"post":{"__typename":"Post","slug":"set-env-var-in-node-project","title":"node 项目读取环境变量","tags":[{"__typename":"Tag","name":"工程化"}],"category":null,"ctime":1697596560000,"mtime":1697616240000,"date":"10-18","content":"\nnode 项目从 `process.env` 读取环境变量时，`process.env` 有哪些来源？\n\n### 命令行\n\n使用 `cross-env` 处理跨平台环境变量设置。\n\n```json title={package.json}\n{\n  \"scripts\": {\n    \"dev\": \"cross-env MY_ENV=hello node ./index.js\",\n    \"start\": \"cross-env MY_ENV=hello webpack\"\n  }\n}\n```\n\n> 在 mac 下可以直接设置局部变量，`{ \"dev\": \"MY_ENV=hello node ./index.js\" }`。\n\n### `.env` 文件\n\n环境变量配置在项目根目录下的 `.env`。\n\n```shell title={.env}\nPORT=8080\nMY_ENV=live\n```\n\n安装 `dotenv`，`npm install dotenv --save`。\n\n`dotenv` 会自动读取项目根目录下的 `.env` 到 `process.env`，并且不会覆盖已存在 `process.env` 上的环境变量。\n\n```javascript title={app.js}\nrequire('dotenv').config();\nconst http = require('http');\nconst port = parseInt(process.env.PORT, 10) || 5000;\nhttp\n  .createServer((request, response) => {\n    response.writeHead(200, {\n      'Content-Type': 'text/plain',\n    });\n    response.write(process.env.MY_ENV);\n    response.end();\n  })\n  .listen(port);\n```\n\n按照 `dotenv` 的最佳实践：\n\n- 应该把 `.env` 加到 `.gitignore`，因为每个环境的配置不同，还可能包含数据库密钥等；\n- 不要按部署环境划分 `.env.test`、`.env.staging` 等环境变量文件，因为难以扩展，更多部署环境就需要添加更多的配置文件。\n\n### shell\n\n如果在执行 node 脚本前，还需为其他的 shell 脚本设置环境变量。\n\n```shell\nset -o allexport # 👉 把后面创建的变量标记为导出，即导出为环境变量\n. ./.env\nset +o allexport # 关闭 👆 这种模式\n```\n\n### 关联\n\n1. [Node Environment Variables: Process env Node](https://www.knowledgehut.com/blog/web-development/node-environment-variables)\n\n> [本博客](https://marsk6.github.io/) 所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\n","prevArticle":{"__typename":"Post","title":"在坚果云设置文件同步过滤规则","slug":"ignore-file-with-jianguoyun-sync"},"nextArticle":null,"readingTime":"1","brief":"使用 `.env` 和 `dotenv` 配置管理 node 项目的环境变量","toc":"- [命令行](#%E5%91%BD%E4%BB%A4%E8%A1%8C)\n- [`.env` 文件](#env-%E6%96%87%E4%BB%B6)\n- [shell](#shell)\n- [关联](#%E5%85%B3%E8%81%94)"},"relatedTags":[{"__typename":"Tag","name":"工程化","posts":[{"__typename":"Post","slug":"set-env-var-in-node-project"}]}]},"__N_SSG":true}